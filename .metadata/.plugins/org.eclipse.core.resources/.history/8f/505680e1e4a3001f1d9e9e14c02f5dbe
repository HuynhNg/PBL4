package org.pbl4.java;

import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

public class TestServer {

	public static void main(String[] args) throws IOException {
		// TODO Auto-generated method stub
		ServerSocket server = new ServerSocket(3000);
        System.out.println("Server is on port 3000...");
        
        while (true) {
            try {
                Socket socket = server.accept();
                System.out.println(socket.getInetAddress() + " Client connected");
                Server tmp = new Server(socket);
                tmp.start();
            } catch (IOException e) {
                System.out.println("Error while accepting client connection: " + e.getMessage());
            }
        }
	}
}

class Server extends Thread{
	private Socket socket;
	private DataInputStream dis;
    private DataOutputStream dos;

    public Server(Socket socket) throws IOException {
        this.socket = socket;
        this.dis = new DataInputStream(socket.getInputStream());
        this.dos = new DataOutputStream(socket.getOutputStream());
    }
    
    public boolean ReceiveFile() {
    	String savePath = "D:\\2024\\PBL4\\FileData\\102220024\\ReceiveFile.zip";
    	System.out.println("Bắt đầu nhận file và lưu tại: " + savePath);
    	try {
        	BufferedInputStream bis = new BufferedInputStream(socket.getInputStream());
            BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(savePath));

            byte[] buffer = new byte[4096];
            int bytesRead;
            while ((bytesRead = bis.read(buffer)) != -1) {
                bos.write(buffer, 0, bytesRead); 
            }

            bos.flush();
            bos.close();
            bis.close();
            System.out.println("Đã nhận file và lưu tại: " + savePath);
            return true;
		} catch (Exception e) {
			System.out.println("Lỗi khi nhận file: " + e.getMessage());
          e.printStackTrace();
          return false;
		}
    }
}
